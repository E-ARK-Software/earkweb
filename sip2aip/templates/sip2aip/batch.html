{% extends "earkweb/base.html" %}
{% load dictionary_extras %}

{% load staticfiles %}

{% block extra_head %}

    <script type="text/javascript" src="/static/earkweb/earkweb/jquery-1.11.2/jquery-1.11.2.js"></script>
    <script type="text/javascript" src="/static/earkweb/earkweb/jquery-1.11.2/jquery.form.min.js"></script>

    <!-- SIP to AIP javascript -->
    <script type="text/javascript" src="{% static 'sip2aip/js/sip2aip.js' %}"></script>

    <!-- Polling -->
    <script type="text/javascript" src="{% static 'earkcore/js/polling.js' %}"></script>

    <!-- batch.html stylesheet -->
    <link rel="stylesheet" href="{% static "sip2aip/css/batch.css" %}" type="text/css" />

{% endblock %}

{% block content %}

    {% include "sip2aip/about_module.html" %}

    <h2 class="main">Batch SIP ingest</h2>

    <p>Batch SIP to AIP conversion applying an ingest workflow</p>
    <p><button id="batch-apply-task">Run batch ingest!</button></p>

    <table class="table table-striped table-bordered table-condensed">
    <thead>
      <tr>
		<th>Package file</th>
		<th>Mime-type</th>
      </tr>
    </thead>
    <tbody id="iplist">

    </tbody>
  </table>

    <script language="JavaScript">
        // module defining the context of the get directory information request
        var get_dir_info_module = {
            request_url: "/earkweb/earkcore/get_directory_json_remote/" +  encodeURIComponent("{{ config_path_reception }}") + "/",
            poll_request_url: "/earkweb/earkcore/poll_state/",
            success_func: function(json_result) {
                for(var i in json_result.children) {
                    var mime = json_result.children[i].data.mimetype;
                    var filename = json_result.children[i].text;
                    $('#iplist').append('<tr><td class="filename"><span class="'+name_to_id(mime)+'">'+filename+'</span></td><td>'+mime+'</td></tr>');
                }
            },
            request_params: {}
        }
        // bind module to function
        var get_dir_info_func = $.proxy( request_func, get_dir_info_module );

        // execute on load
        $(window).load(get_dir_info_func);


        // module defining the context of the get directory information request
        var submit_batch_ingest_module = {
            request_url: "/earkweb/sip2aip/submit_batch_ingest/" +  encodeURIComponent("{{ config_path_reception }}") + "/",
            poll_request_url: "/earkweb/earkcore/poll_state/",
            success_func: function(json_result) {
                 window.console.log(json_result);
            },
            request_params: {}
        }
        // bind module to function
        var submit_batch_ingest_func = $.proxy( request_func, submit_batch_ingest_module );

        // execute on load
        $('#batch-apply-task').click(submit_batch_ingest_func);

    </script>
{% endblock %}


