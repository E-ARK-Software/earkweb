{% extends "earkweb/base.html" %}
{% load dictionary_extras %}

{% load staticfiles %}

{% block extra_head %}

    <!-- SIP to AIP javascript -->
    <script type="text/javascript" src="{% static 'sip2aip/js/sip2aip.js' %}"></script>
    <script type="text/javascript" src="{% static 'earkcore/js/csrfajax.js' %}"></script>

    <script type="text/javascript" src="{% static 'earkweb/bootstrap-notify/bootstrap-notify.js' %}"></script>
    <link rel="stylesheet" href="{% static 'earkweb/bootstrap-notify/bootstrap-notify.css' %}" type="text/css" />

{% endblock %}

{% block content %}

    {% include "sip2aip/about_module.html" %}

    <h2 class="main">Indexing status of packages in AIP storage</h2>

    <p>The indexing of packages available in AIP storage can be initiated here.</p>

    <p><button id="reindexbtn" class="btn btn-default">Index AIP storage</button></p>

    <p>Note that re-indexing AIP storage will delete the existing index first.</p>

    <p>The following table gives an overview about the indexing status of packages available in AIP storage.</p>

    <table class="table table-striped table-bordered table-condensed">
    <thead>
      <tr>
        <th>Package identifier</th>
        <th>Package name</th>
        <th>Process ID</th>
          <th>Number of indexed documents</th>


      </tr>
    </thead>
    <tbody>
        {% for ip in ips %}
            <tr>
                <td><a href="{% url 'sip2aip:ip_detail' ip.pk %}" title='Detail information'>{{ ip.identifier }}</a></td>
                <td><a href="{% url 'sip2aip:ip_detail' ip.pk %}" title='Detail information'>{{ ip.packagename }}</a></td>

                <td>
                    <a href="{% url 'sip2aip:working_area' 'sip2aip' ip.uuid %}" title='Package in working area'>{{ ip.uuid }}</a>
                </td>
                <th>{{ ip.num_indexed_docs_storage }}</th>


            </tr>
        {% endfor %}
    </tbody>
    </table>

    <script>
        $( "#reindexbtn" ).click(function() {
            $.ajax({
                url: "/earkweb/earkcore/reindex_aip_storage",
                context: document.body,
            }).success(function(data) {
                $('#reindexbtn').attr("disabled", "disabled");
                $('.top-right').notify({
                    message: { text: 'Indexing of AIP storage started!' }
                  }).show();
            }).error(function(err, message, status_text) {
                alert("Error!");
            });
        });
	</script>

{% endblock %}
