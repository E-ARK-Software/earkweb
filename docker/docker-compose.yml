version: '2'
services:
  db:
    image: earkdbimg
    container_name: earkdb_1
    build: ./earkdb
    volumes:
      - /tmp/earkweb-mysql-data:/var/lib/mysql
    ports:
      - '3306:3306'
  solr:
    image: solr
    container_name: solr_1
    ports:
      - '8983:8983'
  rabbitmq:
    image: tutum/rabbitmq
    environment:
      - RABBITMQ_PASS=mypass
    container_name: rabbitmq_1
    ports:
      - "5672:5672"  # we forward this port because it's useful for debugging
      - "15672:15672"  # here, we can access rabbitmq management plugi
  web:
    image: earkwebimg
    build: ./earkweb
    container_name: earkweb_1
    command: /docker-entrypoint.sh
#    volumes:
#      - /opt/python_wsgi_apps/earkweb:/earkweb
    ports:
      - "8000:8000"
    depends_on:
      - db
      - solr
      - rabbitmq
  worker:
    build: ./earkweb
    container_name: earkdb_1
    command: /run_celery.sh
#    volumes:
#      - .:/app
    links:
      - db:db
      - rabbitmq:rabbit
